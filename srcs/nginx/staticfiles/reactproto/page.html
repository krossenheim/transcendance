<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Standalone React - Original Code</title>
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <!-- Lucide Icons UMD -->
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.545.0/dist/umd/lucide.js"></script>

    <!-- Prototyping stubs for UI components -->
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/babel">
      window.sendFromContext = function (
        ws,
        target_container,
        funcId,
        payload
      ) {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
          console.warn("WebSocket not open, cannot send message");
          return;
        }

        const message = {
          target_container: target_container,
          funcId,
          payload,
        };
        console.log("Sending ", message);
        ws.send(message);
      };
    </script>
    <script
      type="text/babel"
      src="/static/reactproto/registerForm.js"
      defer
    ></script>
    <script
      type="text/babel"
      src="/static/reactproto/mainIndex.js"
      defer
    ></script>
    <script
      type="text/babel"
      src="/static/reactproto/chatComponent.js"
      defer
    ></script>
    <script
      type="text/babel"
      src="/static/reactproto/loginForm.js"
      defer
    ></script>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const RegisterForm = window.RegisterForm;
      const MainIndex = window.MainIndex;
      const ChatComponent = window.ChatComponent;
      const LoginForm = window.LoginForm;

      console.log("Form:", RegisterForm);
      // Card components
      const Card = ({ children, ...props }) => <div {...props}>{children}</div>;
      const CardHeader = ({ children, ...props }) => (
        <div {...props}>{children}</div>
      );
      const CardTitle = ({ children, ...props }) => (
        <h3 {...props}>{children}</h3>
      );
      const CardDescription = ({ children, ...props }) => (
        <p {...props}>{children}</p>
      );
      const CardContent = ({ children, ...props }) => (
        <div {...props}>{children}</div>
      );

      // Form components
      const Label = ({ children, ...props }) => (
        <label {...props}>{children}</label>
      );
      const Input = ({ ...props }) => <input {...props} />;
      const Button = ({ children, ...props }) => (
        <button {...props}>{children}</button>
      );
      const Alert = ({ children, ...props }) => (
        <div {...props}>{children}</div>
      );
      const AlertDescription = ({ children, ...props }) => (
        <span {...props}>{children}</span>
      );

      function Home() {
        /** @type {[AuthResponseType | null, React.Dispatch<React.SetStateAction<AuthResponseType | null>>]} */
        const [authResponse, setAuthResponse] = useState(null);

        /** @param {AuthResponseType} varTypeAuthResponse */
        function logInOrRegistered(varTypeAuthResponse) {
          console.log("AA: ", varTypeAuthResponse);
          setAuthResponse(varTypeAuthResponse);
        }

        return (
          <main className="min-h-screen flex items-center justify-center">
            {authResponse ? (
              <MainIndex AuthResponseObject={authResponse} />
            ) : (
              <div className="flex gap-8 justify-center items-start">
                <div className="w-1/2">
                  <LoginForm onLoginSuccess={logInOrRegistered} />
                </div>                <div className="w-1/2">
                  <LoginForm onLoginSuccess={logInOrRegistered} />
                </div>
                <div className="w-1/2">
                  <RegisterForm whenCompletedSuccesfully={logInOrRegistered} />
                </div>
              </div>
            )}
          </main>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<Home />);
    </script>
  </body>
</html>
