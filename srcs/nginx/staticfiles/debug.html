<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Per-Action Inputs with WebSocket Output</title>
  </head>
  <body>
    <!-- Buttons + inputs will be generated here -->
    <div id="actions"></div>

    <!-- WebSocket output -->
    <h3>WebSocket Output</h3>
    <div
      id="outputBox"
      style="
        width: 100%;
        height: 200px;
        border: 1px solid #ccc;
        overflow: auto;
        padding: 5px;
        font-family: monospace;
        background: #f9f9f9;
      "
    ></div>

    <script type="module">
      import ws from "/static/websocket.js"; // Replace with your real WebSocket

      ws.addEventListener("message", (event) => {
        console.log("Message from server:", event.data);
        logOutput(event.data);
      });

      function logOutput(message) {
        const box = document.getElementById("outputBox");
        box.innerHTML += message + "<br>";
        box.scrollTop = box.scrollHeight;
      }

      const actions = [
        {
          name: "sendAddRoom",
          label: "Add Room",
          endpoint: "/api/chat/add_a_new_room",
          fields: { room_name: "Room Name" },
        },
        {
          name: "sendAddToRoom",
          label: "Add To Room",
          endpoint: "/api/chat/add_to_room",
          fields: { room_name: "Room Name", added_user_id: "User ID" },
        },
        {
          name: "sendMessage",
          label: "Send Message",
          endpoint: "/api/chat/send_message_to_room",
          fields: { room_name: "Room Name", message: "Message" },
        },
      ];

      const container = document.getElementById("actions");

      actions.forEach((action, index) => {
        const row = document.createElement("div");
        row.style.margin = "8px 0";

        // inputs for this action
        const inputs = {};
        for (const [field, label] of Object.entries(action.fields)) {
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = label;
          input.style.marginRight = "6px";
          row.appendChild(input);
          inputs[field] = input;
        }

        // button for this action
        const btn = document.createElement("button");
        btn.textContent = action.label;
        btn.onclick = () => {
          const payload = { endpoint: action.endpoint };
          for (const [field, input] of Object.entries(inputs)) {
            payload[field] = input.value;
          }
          ws.send(JSON.stringify(payload));
        };
        row.appendChild(btn);

        container.appendChild(row);
      });
    </script>
  </body>
</html>
