<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>the htmls</title>
  </head>
  <body>
    <!-- Buttons + inputs will be generated here -->
    <div id="actions"></div>

    <!-- WebSocket output -->
    <h3>WebSocket Output</h3>
    <div
      id="outputBox"
      style="
        width: 100%;
        height: 200px;
        border: 1px solid #ccc;
        overflow: auto;
        padding: 5px;
        font-family: monospace;
        background: #f9f9f9;
      "
    ></div>
  <input id="myInput" type="text" placeholder="Type raw message" />
  <button id="sendBtn">Send Raw</button>
    <script type="module">
      import ws from "/static/websocket.js"; // Replace with your real WebSocket
    function sendInput() {
      const val = document.getElementById('myInput').value;
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(val);
      } else {
        alert('WebSocket is not connected.');
      }
    }
    document.getElementById('myInput').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') sendInput();
    });
      ws.addEventListener("message", (event) => {
        console.log("Message from server:", event.data);
        logOutput(event.data);
      });

      function logOutput(message) {
        const box = document.getElementById("outputBox");
        box.innerHTML += message + "<br>";
        box.scrollTop = box.scrollHeight;
      }

      const actions = [
        {
          name: "sendAddRoom",
          label: "Add Room",
          endpoint: "/apis/chat/add_a_new_room",
          fields: { room_name: "Room Name" },
        },
        {
          name: "sendAddToRoom",
          label: "Add To Room",
          endpoint: "/api/chat/add_to_room",
          fields: { room_name: "Room Name", user_to_add: "User ID" },
        },
        {
          name: "sendMessage",
          label: "Send Message",
          endpoint: "/api/chat/send_message_to_room",
          fields: { room_name: "Room Name", message: "Message" },
        },
      ];

      const container = document.getElementById("actions");

      actions.forEach((action, index) => {
        const row = document.createElement("div");
        row.style.margin = "8px 0";

        // inputs for this action
        const inputs = {};
        for (const [field, label] of Object.entries(action.fields)) {
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = label;
          input.style.marginRight = "6px";
          row.appendChild(input);
          inputs[field] = input;
        }

        // button for this action
        const btn = document.createElement("button");
        btn.textContent = action.label;
        btn.onclick = () => {
          const payload = { endpoint: action.endpoint };
          for (const [field, input] of Object.entries(inputs)) {
            const raw = input.value;
            const num = Number(raw);

            // Check if conversion succeeded (not NaN)
            payload[field] = !isNaN(num) && raw !== "" ? num : raw;
          }
          ws.send(JSON.stringify(payload));
        };
        row.appendChild(btn);

        container.appendChild(row);
      });
    </script>
  </body>
</html>
