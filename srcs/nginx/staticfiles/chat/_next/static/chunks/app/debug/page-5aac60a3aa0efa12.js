(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[670],{3851:function(e,t,r){Promise.resolve().then(r.bind(r,1729))},1729:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7437),o=r(2265),a=r(2869),s=r(5186),c=r(6070),i=r(5974),l=r(376);function u(){let[e,t]=(0,o.useState)(""),[r,u]=(0,o.useState)([]),[d,f]=(0,o.useState)({}),g=(0,o.useRef)(null),v=(0,o.useRef)(e=>{let t=new Date().toLocaleTimeString();u(r=>[...r,"[".concat(t,"] Received: ").concat(JSON.stringify(e))])}).current,m=(0,o.useRef)(()=>{let e=new Date().toLocaleTimeString();u(t=>[...t,"[".concat(e,"] WebSocket connected")])}).current,b=(0,o.useRef)(()=>{let e=new Date().toLocaleTimeString();u(t=>[...t,"[".concat(e,"] WebSocket disconnected")])}).current,p=(0,o.useRef)(e=>{let t=new Date().toLocaleTimeString();u(e=>[...e,"[".concat(t,"] WebSocket error occurred")])}).current,{socket:h,connectionStatus:x,sendMessage:y}=(0,l.s)({onMessage:v,onConnect:m,onDisconnect:b,onError:p,maxReconnectAttempts:3,reconnectInterval:5e3}),S=e=>{let t=new Date().toLocaleTimeString();u(r=>[...r,"[".concat(t,"] ").concat(e)])},k=()=>{h&&h.readyState===WebSocket.OPEN&&e.trim()?(h.send(e),S("Sent raw: ".concat(e)),t("")):h&&h.readyState===WebSocket.OPEN?S("Error: Message is empty"):S("Error: WebSocket is not connected")},w=e=>{let t=d[e.name]||{},r={endpoint:e.endpoint};for(let[e,n]of Object.entries(t))if(n.trim()){let t=Number(n);r[e]=isNaN(t)||""===n?n:t}if(h&&h.readyState===WebSocket.OPEN){let t=JSON.stringify(r);h.send(t),S("Sent: ".concat(t)),f(t=>({...t,[e.name]:{}}))}else S("Error: WebSocket is not connected")},N=(e,t,r)=>{f(n=>({...n,[e]:{...n[e],[t]:r}}))};return(0,o.useEffect)(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[r]),(0,n.jsxs)("div",{className:"container mx-auto p-6 max-w-4xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"WebSocket Debug Console"}),(0,n.jsx)(i.C,{variant:"connected"===x?"default":"destructive",children:x})]}),(0,n.jsxs)(c.Zb,{className:"mb-6",children:[(0,n.jsxs)(c.Ol,{className:"flex flex-row items-center justify-between",children:[(0,n.jsx)(c.ll,{children:"WebSocket Output"}),(0,n.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>{u([])},children:"Clear Logs"})]}),(0,n.jsx)(c.aY,{children:(0,n.jsx)("div",{ref:g,className:"h-64 p-4 bg-gray-50 dark:bg-gray-900 border rounded-md overflow-auto font-mono text-sm whitespace-pre-wrap",children:0===r.length?(0,n.jsx)("div",{className:"text-gray-500",children:"No messages yet..."}):r.map((e,t)=>(0,n.jsx)("div",{className:"mb-1",children:e},t))})})]}),(0,n.jsxs)(c.Zb,{className:"mb-6",children:[(0,n.jsx)(c.Ol,{children:(0,n.jsx)(c.ll,{children:"Send Raw Message"})}),(0,n.jsx)(c.aY,{children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(s.I,{value:e,onChange:e=>t(e.target.value),placeholder:"Type raw message (JSON or text)",onKeyDown:e=>"Enter"===e.key&&k(),className:"flex-1"}),(0,n.jsx)(a.z,{onClick:k,disabled:"connected"!==x,children:"Send Raw"})]})})]}),(0,n.jsxs)(c.Zb,{children:[(0,n.jsx)(c.Ol,{children:(0,n.jsx)(c.ll,{children:"Predefined Actions"})}),(0,n.jsx)(c.aY,{className:"space-y-4",children:[{name:"sendAddRoom",label:"Add Room",endpoint:"/api/chat/add_a_new_room",fields:{room_name:"Room Name"}},{name:"sendAddToRoom",label:"Add To Room",endpoint:"/api/chat/add_to_room",fields:{room_name:"Room Name",user_to_add:"User ID"}},{name:"sendMessage",label:"Send Message",endpoint:"/api/chat/send_message_to_room",fields:{room_name:"Room Name",message:"Message"}}].map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2 p-4 border rounded-lg",children:[(0,n.jsx)("div",{className:"flex-1 flex gap-2",children:Object.entries(e.fields).map(t=>{var r;let[o,a]=t;return(0,n.jsx)(s.I,{placeholder:a,value:(null===(r=d[e.name])||void 0===r?void 0:r[o])||"",onChange:t=>N(e.name,o,t.target.value),className:"w-48"},o)})}),(0,n.jsx)(a.z,{onClick:()=>w(e),disabled:"connected"!==x,className:"min-w-32",children:e.label})]},e.name))})]}),"connected"!==x&&(0,n.jsx)(c.Zb,{className:"mt-6",children:(0,n.jsx)(c.aY,{className:"pt-6",children:(0,n.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,n.jsx)("p",{className:"mb-2",children:"WebSocket server not available"}),(0,n.jsx)("p",{className:"text-sm",children:"To test with a real server, set the NEXT_PUBLIC_WEBSOCKET_URL environment variable or start a WebSocket server on ws://localhost:8080"})]})})})]})}},5974:function(e,t,r){"use strict";r.d(t,{C:function(){return i}});var n=r(7437);r(2265);var o=r(7053),a=r(535),s=r(4508);let c=(0,a.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,asChild:a=!1,...i}=e,l=a?o.g7:"span";return(0,n.jsx)(l,{"data-slot":"badge",className:(0,s.cn)(c({variant:r}),t),...i})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return i}});var n=r(7437);r(2265);var o=r(7053),a=r(535),s=r(4508);let c=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:t,variant:r,size:a,asChild:i=!1,...l}=e,u=i?o.g7:"button";return(0,n.jsx)(u,{"data-slot":"button",className:(0,s.cn)(c({variant:r,size:a,className:t})),...l})}},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return s},SZ:function(){return i},Zb:function(){return a},aY:function(){return l},ll:function(){return c}});var n=r(7437);r(2265);var o=r(4508);function a(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,o.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function s(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,o.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function c(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,o.cn)("leading-none font-semibold",t),...r})}function i(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,o.cn)("text-muted-foreground text-sm",t),...r})}function l(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,o.cn)("px-6",t),...r})}},5186:function(e,t,r){"use strict";r.d(t,{I:function(){return a}});var n=r(7437);r(2265);var o=r(4508);function a(e){let{className:t,type:r,...a}=e;return(0,n.jsx)("input",{type:r,"data-slot":"input",className:(0,o.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}},376:function(e,t,r){"use strict";r.d(t,{s:function(){return a}});var n=r(2265),o=r(257);function a(e){let{onMessage:t,onConnect:r,onDisconnect:a,onReconnect:s,onError:c,maxReconnectAttempts:i=5,reconnectInterval:l=3e3,url:u}=e,[d,f]=(0,n.useState)(!1),[g,v]=(0,n.useState)(0),[m,b]=(0,n.useState)(null),[p,h]=(0,n.useState)(!1),[x,y]=(0,n.useState)(!1),S=(0,n.useRef)(null),k=(0,n.useRef)(),w=(0,n.useRef)([]),N=(0,n.useRef)(!0),j=(0,n.useRef)(0),R=(0,n.useRef)(!1),W=(0,n.useRef)(t),E=(0,n.useRef)(r),_=(0,n.useRef)(a),C=(0,n.useRef)(s),O=(0,n.useRef)(c);(0,n.useEffect)(()=>{W.current=t},[t]),(0,n.useEffect)(()=>{E.current=r},[r]),(0,n.useEffect)(()=>{_.current=a},[a]),(0,n.useEffect)(()=>{C.current=s},[s]),(0,n.useEffect)(()=>{O.current=c},[c]);let T=(0,n.useCallback)(()=>{let e=u;if(e||(e=o.env.NEXT_PUBLIC_WEBSOCKET_URL||"wss://".concat(window.location.host,"/ws")),console.log("[v0] WebSocket URL from env:",o.env.NEXT_PUBLIC_WEBSOCKET_URL),console.log("[v0] Constructed WebSocket URL:",e),console.log("[v0] Window location:",window.location.href),!e){console.log("[v0] No WebSocket URL available, running in offline mode"),y(!0),b("No WebSocket server configured");return}if(R.current){console.log("[v0] Connection attempt already in progress");return}try{console.log("[v0] Attempting WebSocket connection to:",e),R.current=!0,b(null),y(!1);let t=new WebSocket(e);S.current=t,t.onopen=()=>{var r;for(console.log("[v0] WebSocket connected successfully to:",e),R.current=!1,f(!0),v(0),j.current=0,h(!1),b(null),null===(r=E.current)||void 0===r||r.call(E);w.current.length>0;){let e=w.current.shift();t.readyState===WebSocket.OPEN&&t.send(JSON.stringify(e))}},t.onmessage=e=>{try{let t=e.data;if(console.log("[v0] Received WebSocket message:",t),"string"==typeof t&&t.startsWith("DEBUG:")){let e=t.substring(6),r=JSON.parse(e);r.payload?W.current(r.payload):W.current(r);return}if("string"==typeof t&&t.startsWith("Received: DEBUG:")){let e=t.substring(16),r=JSON.parse(e);r.payload?W.current(r.payload):W.current(r);return}let r=JSON.parse(t);W.current(r)}catch(t){if(console.error("[v0] Failed to parse WebSocket message:",t),console.error("[v0] Raw message was:",e.data),"string"==typeof e.data){if(e.data.includes("Request served by")||e.data.includes("echo.websocket.org")){console.log("[v0] Ignoring echo server response:",e.data);return}e.data.includes("DEBUG:")||e.data.includes("Received:")?W.current({func_name:"generalPopUpText",message:"Server debug: ".concat(e.data.substring(0,100),"...")}):W.current({func_name:"generalPopUpText",message:"Received: ".concat(e.data)})}}},t.onclose=e=>{var t;if(console.log("[v0] WebSocket disconnected. Code:",e.code,"Reason:",e.reason),R.current=!1,f(!1),S.current=null,null===(t=_.current)||void 0===t||t.call(_),N.current&&j.current<i){h(!0),j.current+=1,v(j.current);let e=l*Math.pow(1.5,j.current-1);console.log("[v0] Reconnecting in ".concat(e,"ms (attempt ").concat(j.current,"/").concat(i,")")),k.current=setTimeout(()=>{if(N.current){var e;null===(e=C.current)||void 0===e||e.call(C),T()}},e)}else j.current>=i&&(b("Failed to reconnect after multiple attempts"),h(!1))},t.onerror=r=>{var n;console.error("[v0] WebSocket error occurred:",r),console.error("[v0] WebSocket readyState:",t.readyState),console.error("[v0] WebSocket URL was:",e),R.current=!1,b("Connection failed to ".concat(e)),null===(n=O.current)||void 0===n||n.call(O,r)}}catch(e){console.error("[v0] Failed to create WebSocket connection:",e),R.current=!1,b("Failed to establish connection")}},[u,i,l]),L=(0,n.useCallback)(()=>{console.log("[v0] Manually disconnecting WebSocket"),N.current=!1,R.current=!1,clearTimeout(k.current),S.current&&S.current.close(1e3,"Manual disconnect"),f(!1),h(!1),v(0),j.current=0},[]),U=(0,n.useCallback)(e=>{var t;if((null===(t=S.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN)try{let t=JSON.stringify(e);S.current.send(t),console.log("[v0] Sent WebSocket message:",t)}catch(t){console.error("[v0] Failed to send WebSocket message:",t),w.current.push(e)}else console.log("[v0] WebSocket not connected, queueing message:",e),w.current.push(e),!R.current&&!p&&N.current&&j.current<i&&T()},[p,T,i]),D=(0,n.useCallback)(()=>{v(0),j.current=0,b(null),N.current=!0,R.current=!1,T()},[T]);return(0,n.useEffect)(()=>{N.current=!0;let e=setTimeout(()=>{N.current&&T()},100);return()=>{clearTimeout(e),N.current=!1,R.current=!1,clearTimeout(k.current),S.current&&S.current.close(1e3,"Component unmounting")}},[T]),{socket:S.current,connectionStatus:x?"offline":d?"connected":p?"reconnecting":"disconnected",isConnected:d,isReconnecting:p,reconnectAttempts:g,connectionError:m,isOfflineMode:x,sendMessage:U,disconnect:L,retry:D}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(1994),o=r(3335);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.m6)((0,n.W)(t))}},8575:function(e,t,r){"use strict";r.d(t,{F:function(){return a},e:function(){return s}});var n=r(2265);function o(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function a(...e){return t=>{let r=!1,n=e.map(e=>{let n=o(e,t);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let t=0;t<n.length;t++){let r=n[t];"function"==typeof r?r():o(e[t],null)}}}}function s(...e){return n.useCallback(a(...e),e)}},7053:function(e,t,r){"use strict";r.d(t,{g7:function(){return s}});var n=r(2265),o=r(8575),a=r(7437),s=n.forwardRef((e,t)=>{let{children:r,...o}=e,s=n.Children.toArray(r),i=s.find(l);if(i){let e=i.props.children,r=s.map(t=>t!==i?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(c,{...o,ref:t,children:n.isValidElement(e)?n.cloneElement(e,void 0,r):null})}return(0,a.jsx)(c,{...o,ref:t,children:r})});s.displayName="Slot";var c=n.forwardRef((e,t)=>{let{children:r,...a}=e;if(n.isValidElement(r)){let e,s;let c=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref;return n.cloneElement(r,{...function(e,t){let r={...t};for(let n in t){let o=e[n],a=t[n];/^on[A-Z]/.test(n)?o&&a?r[n]=(...e)=>{a(...e),o(...e)}:o&&(r[n]=o):"style"===n?r[n]={...o,...a}:"className"===n&&(r[n]=[o,a].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props),ref:t?(0,o.F)(t,c):c})}return n.Children.count(r)>1?n.Children.only(null):null});c.displayName="SlotClone";var i=({children:e})=>(0,a.jsx)(a.Fragment,{children:e});function l(e){return n.isValidElement(e)&&e.type===i}}},function(e){e.O(0,[376,971,117,744],function(){return e(e.s=3851)}),_N_E=e.O()}]);