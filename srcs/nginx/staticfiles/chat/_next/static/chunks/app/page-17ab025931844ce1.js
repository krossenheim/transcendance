(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6679:function(e,t,s){Promise.resolve().then(s.bind(s,1603))},1603:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eg}});var r=s(7437),n=s(2265),a=s(2869),o=s(5186),i=s(6070),l=s(6394),c=s(4508);function d(e){let{className:t,...s}=e;return(0,r.jsx)(l.f,{"data-slot":"label",className:(0,c.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}var u=s(1312);function m(e){let{className:t,...s}=e;return(0,r.jsx)(u.fC,{"data-slot":"tabs",className:(0,c.cn)("flex flex-col gap-2",t),...s})}function g(e){let{className:t,...s}=e;return(0,r.jsx)(u.aV,{"data-slot":"tabs-list",className:(0,c.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function f(e){let{className:t,...s}=e;return(0,r.jsx)(u.xz,{"data-slot":"tabs-trigger",className:(0,c.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function x(e){let{className:t,...s}=e;return(0,r.jsx)(u.VY,{"data-slot":"tabs-content",className:(0,c.cn)("flex-1 outline-none",t),...s})}var h=s(4890),p=s(875),v=s(401),b=s(2135);function j(e){let{...t}=e;return(0,r.jsx)(h.fC,{"data-slot":"select",...t})}function y(e){let{...t}=e;return(0,r.jsx)(h.B4,{"data-slot":"select-value",...t})}function w(e){let{className:t,size:s="default",children:n,...a}=e;return(0,r.jsxs)(h.xz,{"data-slot":"select-trigger","data-size":s,className:(0,c.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[n,(0,r.jsx)(h.JO,{asChild:!0,children:(0,r.jsx)(p.Z,{className:"size-4 opacity-50"})})]})}function N(e){let{className:t,children:s,position:n="popper",...a}=e;return(0,r.jsx)(h.h_,{children:(0,r.jsxs)(h.VY,{"data-slot":"select-content",className:(0,c.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...a,children:[(0,r.jsx)(S,{}),(0,r.jsx)(h.l_,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,r.jsx)(C,{})]})})}function _(e){let{className:t,children:s,...n}=e;return(0,r.jsxs)(h.ck,{"data-slot":"select-item",className:(0,c.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...n,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(h.wU,{children:(0,r.jsx)(v.Z,{className:"size-4"})})}),(0,r.jsx)(h.eT,{children:s})]})}function S(e){let{className:t,...s}=e;return(0,r.jsx)(h.u_,{"data-slot":"select-scroll-up-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(b.Z,{className:"size-4"})})}function C(e){let{className:t,...s}=e;return(0,r.jsx)(h.$G,{"data-slot":"select-scroll-down-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,r.jsx)(p.Z,{className:"size-4"})})}var k=s(5974),R=s(5156);function z(e){let{className:t,orientation:s="horizontal",decorative:n=!0,...a}=e;return(0,r.jsx)(R.f,{"data-slot":"separator",decorative:n,orientation:s,className:(0,c.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...a})}var D=s(376),I=s(5153);let E={rooms:[],currentRoom:"",messageHistory:{},userPreferences:{theme:"system",notifications:!0,soundEnabled:!0}};var O=s(4930);function U(e){let{className:t,...s}=e;return(0,r.jsx)(O.fC,{"data-slot":"avatar",className:(0,c.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...s})}function T(e){let{className:t,...s}=e;return(0,r.jsx)(O.NY,{"data-slot":"avatar-fallback",className:(0,c.cn)("bg-muted flex size-full items-center justify-center rounded-full",t),...s})}function A(e){let{messages:t,currentUser:s}=e,a=(0,n.useRef)(null),o=()=>{var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{o()},[t]);let i=e=>{let t=e instanceof Date?e:new Date(e);return new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).format(t)},l=e=>{let t=new Date(e),s=new Date;if(t.toDateString()===s.toDateString())return"Today";let r=new Date(s);return(r.setDate(r.getDate()-1),t.toDateString()===r.toDateString())?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==s.getFullYear()?"numeric":void 0})},d=(e=>{let t={};return e.forEach(e=>{let s=e.timestamp instanceof Date?e.timestamp:new Date(e.timestamp),r=s.toDateString();t[r]||(t[r]=[]),t[r].push({...e,timestamp:s})}),t})(t);return 0===t.length?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-lg font-medium",children:"No messages yet"}),(0,r.jsx)("div",{className:"text-sm",children:"Start the conversation!"})]})}):(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2",children:[Object.entries(d).map(e=>{let[t,n]=e;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-center my-4",children:[(0,r.jsx)("div",{className:"flex-1 border-t border-border"}),(0,r.jsx)(k.C,{variant:"secondary",className:"mx-4 text-xs",children:l(new Date(t))}),(0,r.jsx)("div",{className:"flex-1 border-t border-border"})]}),(0,r.jsx)("div",{className:"space-y-3",children:n.map((e,t)=>{let a=e.sender===s.username,o=e.isSystem,l=0===t||n[t-1].sender!==e.sender;return o?(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(k.C,{variant:"outline",className:"text-xs",children:e.text})},e.id):(0,r.jsxs)("div",{className:(0,c.cn)("flex gap-3 group",a&&"flex-row-reverse"),children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:l?(0,r.jsx)(U,{className:"w-8 h-8",children:(0,r.jsx)(T,{className:"text-xs",children:e.sender.charAt(0).toUpperCase()})}):(0,r.jsx)("div",{className:"w-8 h-8"})}),(0,r.jsxs)("div",{className:(0,c.cn)("flex-1 max-w-[70%]",a&&"text-right"),children:[l&&(0,r.jsxs)("div",{className:(0,c.cn)("flex items-center gap-2 mb-1",a&&"justify-end"),children:[(0,r.jsx)("span",{className:"text-sm font-medium text-foreground",children:a?"You":e.sender}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:i(e.timestamp)})]}),(0,r.jsx)("div",{className:(0,c.cn)("inline-block px-3 py-2 rounded-lg text-sm break-words",a?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground",!l&&"mt-1"),children:e.text}),!l&&(0,r.jsx)("div",{className:(0,c.cn)("opacity-0 group-hover:opacity-100 transition-opacity mt-1",a&&"text-right"),children:(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:i(e.timestamp)})})]})]},e.id)})})]},t)}),(0,r.jsx)("div",{ref:a})]})}var W=s(6966);let M=W.zt,P=W.fC,F=W.xz,J=n.forwardRef((e,t)=>{let{className:s,sideOffset:n=4,...a}=e;return(0,r.jsx)(W.VY,{ref:t,sideOffset:n,className:(0,c.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})});function L(e){let{users:t,currentUser:s,getUserLastSeen:n,isUserOnline:a}=e,o=[...t].sort((e,t)=>{if(e.id===s.id)return -1;if(t.id===s.id)return 1;let r=a?a(e.id):e.isOnline,n=a?a(t.id):t.isOnline;return r&&!n?-1:!r&&n?1:e.username.localeCompare(t.username)}),i=e=>{if(!e)return"Never";let t=new Date().getTime()-e.getTime(),s=Math.floor(t/6e4),r=Math.floor(t/36e5);return s<1?"Just now":s<60?"".concat(s,"m ago"):r<24?"".concat(r,"h ago"):"".concat(Math.floor(t/864e5),"d ago")};return(0,r.jsx)(M,{children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Users"}),(0,r.jsx)(k.C,{variant:"secondary",className:"text-xs",children:t.length})]}),0===t.length?(0,r.jsx)("div",{className:"text-sm text-muted-foreground text-center py-4",children:"No users online"}):(0,r.jsx)("div",{className:"space-y-2",children:o.map(e=>{let t=a?a(e.id):e.isOnline,o=n?n(e.id):e.lastSeen;return(0,r.jsxs)(P,{children:[(0,r.jsx)(F,{asChild:!0,children:(0,r.jsxs)("div",{className:"flex items-center gap-2 p-1 rounded hover:bg-muted/50 cursor-pointer",children:[(0,r.jsx)(U,{className:"w-6 h-6",children:(0,r.jsx)(T,{className:"text-xs",children:e.username.charAt(0).toUpperCase()})}),(0,r.jsx)("span",{className:"text-sm flex-1 truncate",children:e.id===s.id?"You":e.username}),(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(t?"bg-green-500":"bg-gray-400")})]})}),(0,r.jsx)(J,{side:"right",children:(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsx)("div",{className:"font-medium",children:e.username}),(0,r.jsx)("div",{className:"text-muted-foreground",children:t?"Online":"Last seen: ".concat(i(o))})]})})]},e.id)})})]})})}J.displayName=W.VY.displayName;var Z=s(9027),Y=s(2489);function V(e){let{...t}=e;return(0,r.jsx)(Z.fC,{"data-slot":"dialog",...t})}function q(e){let{...t}=e;return(0,r.jsx)(Z.xz,{"data-slot":"dialog-trigger",...t})}function H(e){let{...t}=e;return(0,r.jsx)(Z.h_,{"data-slot":"dialog-portal",...t})}function B(e){let{className:t,...s}=e;return(0,r.jsx)(Z.aV,{"data-slot":"dialog-overlay",className:(0,c.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function G(e){let{className:t,children:s,showCloseButton:n=!0,...a}=e;return(0,r.jsxs)(H,{"data-slot":"dialog-portal",children:[(0,r.jsx)(B,{}),(0,r.jsxs)(Z.VY,{"data-slot":"dialog-content",className:(0,c.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a,children:[s,n&&(0,r.jsxs)(Z.x8,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,r.jsx)(Y.Z,{}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function K(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"dialog-header",className:(0,c.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function X(e){let{className:t,...s}=e;return(0,r.jsx)(Z.Dx,{"data-slot":"dialog-title",className:(0,c.cn)("text-lg leading-none font-semibold",t),...s})}function $(e){let{className:t,...s}=e;return(0,r.jsx)(Z.dk,{"data-slot":"dialog-description",className:(0,c.cn)("text-muted-foreground text-sm",t),...s})}var Q=s(9397),ee=s(7806);function et(e){let{onRoomCreated:t,currentRoom:s,sendMessage:i,isConnected:l}=e,[c,u]=(0,n.useState)(""),[m,g]=(0,n.useState)(""),[f,x]=(0,n.useState)(!1),[h,p]=(0,n.useState)(!1);return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(V,{open:f,onOpenChange:x,children:[(0,r.jsx)(q,{asChild:!0,children:(0,r.jsxs)(a.z,{variant:"outline",size:"sm",className:"w-full bg-transparent",disabled:!l,children:[(0,r.jsx)(Q.Z,{className:"w-4 h-4 mr-2"}),"Create Room"]})}),(0,r.jsxs)(G,{children:[(0,r.jsxs)(K,{children:[(0,r.jsx)(X,{children:"Create New Room"}),(0,r.jsx)($,{children:"Create a new chat room. Room names must contain only letters and numbers."})]}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!c.trim()||!l)return;let s=c.trim().toLowerCase().replace(/[^a-z0-9]/g,"");s&&(console.log("[v0] Creating room:",s),i({endpoint:"/api/chat/add_a_new_room",room_name:s}),t(s),u(""),x(!1))},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{htmlFor:"room-name",children:"Room Name"}),(0,r.jsx)(o.I,{id:"room-name",value:c,onChange:e=>u(e.target.value),placeholder:"Enter room name...",required:!0})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(a.z,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),(0,r.jsx)(a.z,{type:"submit",disabled:!c.trim(),children:"Create Room"})]})]})]})]}),(0,r.jsxs)(V,{open:h,onOpenChange:p,children:[(0,r.jsx)(q,{asChild:!0,children:(0,r.jsxs)(a.z,{variant:"outline",size:"sm",className:"w-full bg-transparent",disabled:!l,children:[(0,r.jsx)(ee.Z,{className:"w-4 h-4 mr-2"}),"Invite User"]})}),(0,r.jsxs)(G,{children:[(0,r.jsxs)(K,{children:[(0,r.jsxs)(X,{children:["Invite User to #",s]}),(0,r.jsx)($,{children:"Enter the username of the person you want to invite to this room."})]}),(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!m.trim()||!l)return;let t=Number.parseInt(m.trim(),10);isNaN(t)||(i({endpoint:"/api/chat/add_to_room",room_name:s,user_to_add:t}),g(""),p(!1))},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{htmlFor:"user-to-add",children:"User ID"}),(0,r.jsx)(o.I,{id:"user-to-add",value:m,onChange:e=>g(e.target.value),placeholder:"Enter user ID (number)...",type:"number",required:!0})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(a.z,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),(0,r.jsx)(a.z,{type:"submit",disabled:!m.trim(),children:"Send Invite"})]})]})]})]})]})}let es=(0,s(535).j)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function er(e){let{className:t,variant:s,...n}=e;return(0,r.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,c.cn)(es({variant:s}),t),...n})}function en(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"alert-description",className:(0,c.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...s})}var ea=s(2926),eo=s(9076),ei=s(5395),el=s(9322);function ec(e){let{isConnected:t,isReconnecting:s,reconnectAttempts:n,connectionError:o,onRetry:i}=e;return t?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(ea.Z,{className:"w-4 h-4 text-green-500"}),(0,r.jsx)(k.C,{variant:"secondary",className:"text-green-700 bg-green-50",children:"Connected"})]}):s?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eo.Z,{className:"w-4 h-4 text-yellow-500 animate-spin"}),(0,r.jsxs)(k.C,{variant:"secondary",className:"text-yellow-700 bg-yellow-50",children:["Reconnecting... (",n,"/5)"]})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(ei.Z,{className:"w-4 h-4 text-red-500"}),(0,r.jsx)(k.C,{variant:"destructive",children:"Disconnected"})]}),o&&(0,r.jsxs)(er,{variant:"destructive",children:[(0,r.jsx)(el.Z,{className:"h-4 w-4"}),(0,r.jsxs)(en,{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{children:o}),(0,r.jsx)(a.z,{variant:"outline",size:"sm",onClick:i,children:"Retry"})]})]})]})}var ed=s(8930);function eu(e){let{user:t}=e,{rooms:s,currentRoom:l,updateRooms:c,setCurrentRoom:d,addMessage:u,getRoomMessages:m,getUnreadCount:g,userPreferences:f,clearRoomMessages:x}=function(e){let[t,s]=function(e,t){let[s,r]=(0,n.useState)(()=>{try{let s=window.localStorage.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error('Error reading localStorage key "'.concat(e,'":'),s),t}});return[s,(0,n.useCallback)(t=>{try{r(s=>{let r=t instanceof Function?t(s):t;return window.localStorage.setItem(e,JSON.stringify(r)),r})}catch(t){console.error('Error setting localStorage key "'.concat(e,'":'),t)}},[e])]}("chatroom-state-".concat(e),E),[r,a]=function(e,t){let[s,r]=(0,n.useState)(()=>{try{let s=window.sessionStorage.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error('Error reading sessionStorage key "'.concat(e,'":'),s),t}});return[s,(0,n.useCallback)(t=>{try{r(s=>{let r=t instanceof Function?t(s):t;return window.sessionStorage.setItem(e,JSON.stringify(r)),r})}catch(t){console.error('Error setting sessionStorage key "'.concat(e,'":'),t)}},[e])]}("chatroom-session-".concat(e),{lastActiveRoom:t.currentRoom,unreadCounts:{}}),o=(0,n.useCallback)(e=>{s(t=>({...t,rooms:[...new Set(e)]}))},[s]),i=(0,n.useCallback)(e=>{s(t=>({...t,currentRoom:e})),a(t=>({...t,lastActiveRoom:e,unreadCounts:{...t.unreadCounts,[e]:0}}))},[s,a]),l=(0,n.useCallback)(e=>{s(t=>{let s=[...t.messageHistory[e.room]||[],e].slice(-100);return{...t,messageHistory:{...t.messageHistory,[e.room]:s}}}),a(t=>(s(t=>(e.room===t.currentRoom||e.isSystem||a(t=>({...t,unreadCounts:{...t.unreadCounts,[e.room]:(t.unreadCounts[e.room]||0)+1}})),t)),t))},[s,a]),c=(0,n.useCallback)(e=>{s(t=>({...t,messageHistory:{...t.messageHistory,[e]:[]}}))},[s]),d=(0,n.useCallback)(e=>{s(t=>({...t,userPreferences:{...t.userPreferences,...e}}))},[s]),u=(0,n.useCallback)(e=>(t.messageHistory[e]||[]).map(e=>({...e,timestamp:e.timestamp instanceof Date?e.timestamp:new Date(e.timestamp)})),[t.messageHistory]),m=(0,n.useCallback)(e=>r.unreadCounts[e]||0,[r.unreadCounts]),g=(0,n.useMemo)(()=>Object.values(r.unreadCounts).reduce((e,t)=>e+t,0),[r.unreadCounts]),f=(0,n.useCallback)(()=>({...t,exportedAt:new Date().toISOString(),userId:e}),[t,e]),x=(0,n.useCallback)(t=>{t.userId===e&&s({rooms:t.rooms||E.rooms,currentRoom:t.currentRoom||E.currentRoom,messageHistory:t.messageHistory||{},userPreferences:{...E.userPreferences,...t.userPreferences}})},[e,s]);return{rooms:t.rooms,currentRoom:t.currentRoom,userPreferences:t.userPreferences,lastActiveRoom:r.lastActiveRoom,updateRooms:o,setCurrentRoom:i,addMessage:l,clearRoomMessages:c,updateUserPreferences:d,getRoomMessages:u,getUnreadCount:m,getTotalUnreadCount:g,exportChatData:f,importChatData:x}}(t.id),[h,p]=(0,n.useState)(""),[v,b]=(0,n.useState)(()=>m(l)),[S,C]=(0,n.useState)([]),[R,O]=(0,n.useState)(new Set),[U,T]=(0,n.useState)([]),[W,M]=(0,n.useState)(0===s.length),[P,F]=(0,n.useState)(null),J=(0,n.useRef)(null),Z=(0,n.useRef)(),{toast:Y}=(0,I.pm)();(0,n.useEffect)(()=>{J.current=P},[P]);let V=(0,n.useCallback)(e=>{if(console.log("[v0] Received WebSocket message:",e),!e||"object"!=typeof e){console.warn("[v0] Invalid message data received:",e);return}if(e.user_id&&"number"==typeof e.user_id){console.log("[v0] Setting WebSocket user ID:",e.user_id),F(e.user_id),O(s=>{let r=new Set(s);return r.add(e.user_id),C(Array.from(r).map(s=>({id:s.toString(),username:s===e.user_id?t.username:"User ".concat(s)}))),r}),Y({title:"User Connected",description:"User ID ".concat(e.user_id," joined the chat")});return}if("chatRoomUserCount"===e.func_name||e.room_name&&void 0!==e.user_count){console.log("[v0] Room user count update:",e),e.room_name===l&&C(Array.from({length:e.user_count||0},(e,s)=>({id:(s+1).toString(),username:0===s?t.username:"User ".concat(s+1)})));return}if("userJoinedRoom"===e.func_name||e.user_id&&e.room_name&&"joined"===e.action){console.log("[v0] User joined room:",e),e.room_name===l&&O(s=>{let r=new Set(s);return r.add(e.user_id),C(Array.from(r).map(s=>({id:s.toString(),username:s===e.user_id?t.username:"User ".concat(s)}))),r});return}if(e.room_list&&Array.isArray(e.room_list)){console.log("[v0] Processing room list:",e.room_list),c(e.room_list),e.room_list.includes(l)||(d(e.room_list[0]||""),b([])),Y({title:"Rooms Loaded",description:"Found ".concat(e.room_list.length," existing rooms")});return}switch(e.func_name){case"chatAddMessageToRoom":if(e.room_name&&e.message){let t={id:Date.now(),text:e.message,sender:e.sender||"Unknown",timestamp:new Date,room:e.room_name};u(t),e.room_name===l&&b(e=>[...e,t])}break;case"chatRoomAdded":if(e.room_name&&!s.includes(e.room_name)){c([...s,e.room_name]),l||d(e.room_name);let t=J.current;console.log("[v0] Room added, attempting to join. Current wsUserId:",t),X&&t?(console.log("[v0] Sending add_to_room request:",{endpoint:"/api/chat/add_to_room",room_name:e.room_name,user_to_add:t}),X({endpoint:"/api/chat/add_to_room",room_name:e.room_name,user_to_add:t})):console.warn("[v0] Cannot join room - missing sendWsMessage or wsUserId:",{sendWsMessage:!!X,wsUserId:t}),Y({title:"Room Created",description:"Room #".concat(e.room_name," has been created")})}break;case"chatRoomList":e.rooms&&Array.isArray(e.rooms)&&(c(e.rooms),e.rooms.includes(l)||(d(e.rooms[0]||""),b([])),Y({title:"Rooms Loaded",description:"Found ".concat(e.rooms.length," existing rooms")}));break;case"generalPopUpText":if(e.pop_up_text){let t=e.pop_up_text;"object"==typeof t&&(t=t["(root)"]||JSON.stringify(t));let r=t.includes("doesn't exist")&&400===e.status,n=t.includes("already exists")&&208===e.status;if(t.includes("user_id")&&t.includes("isn't in it")&&400===e.status){let e=t.match(/Room (\w+) doesn't exist or user_id/);if(e){let t=e[1];console.log("[v0] User not in room, attempting to join:",t),s.includes(t)||c([...s,t]);let r=J.current;if(X&&r){console.log("[v0] Sending add_to_room request for existing room:",{endpoint:"/api/chat/add_to_room",room_name:t,user_to_add:r}),X({endpoint:"/api/chat/add_to_room",room_name:t,user_to_add:r}),Y({title:"Joining Room",description:"Attempting to join room #".concat(t,"..."),variant:"secondary"});return}}Y({title:"Room Access Required",description:"You need to be added to this room to send messages",variant:"destructive"})}else if(r){let e=t.match(/Room (\w+) doesn't exist/);if(e){let t=e[1];c(s.filter(e=>e!==t)),l===t&&(d(""),b([]))}Y({title:"Room Not Found",description:t,variant:"destructive"})}else if(n){let e=t.match(/Room (\w+) already exists/);if(e){let t=e[1];console.log("[v0] Room already exists, attempting to join:",t),s.includes(t)||c([...s,t]),l||d(t);let r=J.current;X&&r&&(console.log("[v0] Joining existing room:",{endpoint:"/api/chat/add_to_room",room_name:t,user_to_add:r}),X({endpoint:"/api/chat/add_to_room",room_name:t,user_to_add:r}))}Y({title:"Joining Existing Room",description:"Room already exists, joining it now...",variant:"secondary"})}else{let e={id:Date.now(),text:t,sender:"System",timestamp:new Date,room:l||"system",isSystem:!0};u(e),l&&b(t=>[...t,e]),Y({title:"System Message",description:t})}}break;default:console.log("[v0] Unhandled message type:",e.func_name)}},[u,l,s,c,Y,t.id,t.username,d]),q=(0,n.useCallback)(()=>{console.log("[v0] Connected to chat server"),Y({title:"Connected",description:"Successfully connected to chat server"}),G&&G.send(JSON.stringify({endpoint:"/api/chat/list_rooms"}))},[Y,G]),H=(0,n.useCallback)(()=>{console.log("[v0] Disconnected from chat server"),Y({title:"Disconnected",description:"Lost connection to chat server",variant:"destructive"})},[Y]),B=(0,n.useCallback)(e=>{console.error("[v0] WebSocket error:",e),Y({title:"Connection Error",description:"Unable to connect to chat server. Using offline mode.",variant:"destructive"})},[Y]),{socket:G,connectionStatus:K,sendMessage:X,isConnected:$,isReconnecting:Q,reconnectAttempts:ee,connectionError:es,isOfflineMode:er,retry:en}=(0,D.s)({onMessage:V,onConnect:q,onDisconnect:H,onError:B,maxReconnectAttempts:3,reconnectInterval:5e3}),ea=(0,n.useCallback)(()=>{W&&X&&(X({endpoint:"/api/chat/add_a_new_room",room_name:"lobby"}),M(!1))},[W,X]),eo=(0,n.useCallback)(()=>{if(h.trim()){if(!$){let e={id:Date.now(),text:h.trim(),sender:t.username,timestamp:new Date,room:l};u(e),b(t=>[...t,e]),p(""),Y({title:"Offline Mode",description:"Message sent in offline mode (demo only)",variant:"secondary"});return}X({endpoint:"/api/chat/send_message_to_room",message:h.trim(),room_name:l}),p(""),clearTimeout(Z.current)}},[h,$,t,l,u,Y,X]),ei=(0,n.useCallback)(e=>{p(e)},[]),el=(0,n.useCallback)(e=>{d(e),b(m(e));let t=J.current;console.log("[v0] Room changed, attempting to join. Current wsUserId:",t),$&&X&&t?(console.log("[v0] Sending add_to_room request for room change:",{endpoint:"/api/chat/add_to_room",room_name:e,user_to_add:t}),X({endpoint:"/api/chat/add_to_room",room_name:e,user_to_add:t})):console.warn("[v0] Cannot join room on change - missing connection or wsUserId:",{isConnected:$,sendWsMessage:!!X,wsUserId:t}),Y({title:"Room Changed",description:"Switched to #".concat(e)})},[d,m,Y,$,X]),eu=(0,n.useCallback)(()=>{x(l),b([]),Y({title:"Chat Cleared",description:"All messages in #".concat(l," have been cleared")})},[x,l,Y]),em=(0,n.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),eo())},[eo]);return(0,n.useEffect)(()=>{$&&W&&ea()},[$,W,ea]),(0,n.useEffect)(()=>{b(m(l))},[l,m]),(0,n.useEffect)(()=>{G&&$&&G.send(JSON.stringify({endpoint:"/api/chat/list_rooms"}))},[G,$]),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 h-[calc(100vh-8rem)]",children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)(i.Zb,{className:"h-full",children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{className:"text-lg",children:"Rooms"}),(0,r.jsx)(ec,{isConnected:$,isReconnecting:Q,reconnectAttempts:ee,connectionError:es,onRetry:en}),(er||!$&&!Q)&&(0,r.jsx)(k.C,{variant:"secondary",className:"w-fit",children:er?"Demo Mode":"Offline Mode"})]}),(0,r.jsxs)(i.aY,{className:"space-y-4",children:[s.length>0?(0,r.jsxs)(j,{value:l||void 0,onValueChange:el,children:[(0,r.jsx)(w,{children:(0,r.jsx)(y,{placeholder:"Select a room"})}),(0,r.jsx)(N,{children:s.map(e=>{let t=g(e);return(0,r.jsx)(_,{value:e,children:(0,r.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,r.jsxs)("span",{children:["#",e]}),t>0&&(0,r.jsx)(k.C,{variant:"destructive",className:"ml-2 text-xs",children:t})]})},e)})})]}):(0,r.jsx)("div",{className:"text-center text-sm text-muted-foreground p-4 border border-dashed rounded-lg",children:$?"No rooms yet. Create one below!":"Connect to see rooms"}),(0,r.jsx)(et,{onRoomCreated:e=>{s.includes(e)||(c([...s,e]),d(e))},currentRoom:l,sendMessage:X,isConnected:$}),(0,r.jsx)(z,{}),(0,r.jsx)(L,{users:S,currentUser:t,getUserLastSeen:()=>new Date,isUserOnline:()=>!1})]})]})}),(0,r.jsx)("div",{className:"lg:col-span-3",children:(0,r.jsxs)(i.Zb,{className:"h-full flex flex-col",children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(i.ll,{children:l?"#".concat(l):"No Room Selected"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(k.C,{variant:"secondary",children:[S.length," online"]}),v.length>0&&(0,r.jsxs)(k.C,{variant:"outline",children:[v.length," messages"]}),(0,r.jsx)(k.C,{variant:$?"default":"secondary",children:K}),v.length>0&&l&&(0,r.jsx)(a.z,{variant:"outline",size:"sm",onClick:eu,className:"text-destructive hover:text-destructive bg-transparent",children:(0,r.jsx)(ed.Z,{className:"w-4 h-4"})})]})]}),U.length>0&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground animate-pulse",children:[U.join(", ")," ",1===U.length?"is":"are"," typing..."]})]}),(0,r.jsxs)(i.aY,{className:"flex-1 flex flex-col gap-4",children:[l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A,{messages:v,currentUser:t}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.I,{value:h,onChange:e=>ei(e.target.value),onKeyPress:em,placeholder:$?"Message #".concat(l,"..."):"Offline mode - messages won't be sent to server",className:"flex-1"}),(0,r.jsx)(a.z,{onClick:eo,disabled:!h.trim(),children:"Send"})]})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Welcome to the Chat!"}),(0,r.jsx)("p",{className:"text-sm mb-4",children:0===s.length?"Create your first room to get started":"Select a room from the sidebar to start chatting"}),$&&0===s.length&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:W?"Creating default room...":"Use the 'Create Room' button to begin"})]})}),!$&&(0,r.jsx)("div",{className:"text-center text-sm text-muted-foreground",children:Q?(0,r.jsxs)("div",{className:"animate-pulse",children:["Reconnecting to chat server... (attempt ",ee,"/3)"]}):er?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{children:"Running in demo mode"}),(0,r.jsx)("div",{className:"text-xs",children:"Messages are stored locally for demonstration purposes."})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{children:"Disconnected from chat server"}),(0,r.jsx)("div",{className:"text-xs",children:"Running in offline mode. Messages will be stored locally."}),es&&(0,r.jsx)(a.z,{variant:"outline",size:"sm",onClick:en,children:"Try Reconnect"})]})})]})]})})]})}let em=(0,n.createContext)(null);function eg(){let{user:e,login:t,register:s,logout:l,isLoading:c}=function(){let[e,t]=(0,n.useState)(null),[s,r]=(0,n.useState)(!0),a=(0,n.useContext)(em);(0,n.useEffect)(()=>{let e=localStorage.getItem("chatroom-user");if(e)try{t(JSON.parse(e))}catch(e){localStorage.removeItem("chatroom-user")}r(!1)},[]);let o=async(e,s)=>{if(e&&s){let s={id:Date.now().toString(),username:e};t(s),localStorage.setItem("chatroom-user",JSON.stringify(s))}else throw Error("Invalid credentials")},i=async(e,s)=>{if(e&&s){let s={id:Date.now().toString(),username:e};t(s),localStorage.setItem("chatroom-user",JSON.stringify(s))}else throw Error("Registration failed")};return a||{user:e,login:o,register:i,logout:()=>{t(null),localStorage.removeItem("chatroom-user")},isLoading:s}}(),[u,h]=(0,n.useState)({username:"",password:""}),[p,v]=(0,n.useState)({username:"",password:"",confirmPassword:""}),[b,j]=(0,n.useState)(""),y=async e=>{e.preventDefault(),j("");try{await t(u.username,u.password)}catch(e){j("Invalid credentials")}},w=async e=>{if(e.preventDefault(),j(""),p.password!==p.confirmPassword){j("Passwords do not match");return}try{await s(p.username,p.password)}catch(e){j("Username already exists")}};return c?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-lg",children:"Loading..."})}):e?(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)("header",{className:"border-b bg-card",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"ChatRoom"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Welcome, ",e.username]}),(0,r.jsx)(a.z,{variant:"outline",size:"sm",onClick:l,children:"Sign Out"})]})]})}),(0,r.jsx)("main",{className:"container mx-auto p-4",children:(0,r.jsx)(eu,{user:e})})]}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,r.jsxs)(i.Zb,{className:"w-full max-w-md",children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Welcome to ChatRoom"}),(0,r.jsx)(i.SZ,{children:"Sign in or create an account to start chatting"})]}),(0,r.jsx)(i.aY,{children:(0,r.jsxs)(m,{defaultValue:"login",className:"w-full",children:[(0,r.jsxs)(g,{className:"grid w-full grid-cols-2",children:[(0,r.jsx)(f,{value:"login",children:"Login"}),(0,r.jsx)(f,{value:"register",children:"Register"})]}),(0,r.jsx)(x,{value:"login",children:(0,r.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{htmlFor:"login-username",children:"Username"}),(0,r.jsx)(o.I,{id:"login-username",type:"text",value:u.username,onChange:e=>h(t=>({...t,username:e.target.value})),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{htmlFor:"login-password",children:"Password"}),(0,r.jsx)(o.I,{id:"login-password",type:"password",value:u.password,onChange:e=>h(t=>({...t,password:e.target.value})),required:!0})]}),b&&(0,r.jsx)("div",{className:"text-destructive text-sm",children:b}),(0,r.jsx)(a.z,{type:"submit",className:"w-full",children:"Sign In"})]})}),(0,r.jsx)(x,{value:"register",children:(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{htmlFor:"register-username",children:"Username"}),(0,r.jsx)(o.I,{id:"register-username",type:"text",value:p.username,onChange:e=>v(t=>({...t,username:e.target.value})),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{htmlFor:"register-password",children:"Password"}),(0,r.jsx)(o.I,{id:"register-password",type:"password",value:p.password,onChange:e=>v(t=>({...t,password:e.target.value})),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{htmlFor:"confirm-password",children:"Confirm Password"}),(0,r.jsx)(o.I,{id:"confirm-password",type:"password",value:p.confirmPassword,onChange:e=>v(t=>({...t,confirmPassword:e.target.value})),required:!0})]}),b&&(0,r.jsx)("div",{className:"text-destructive text-sm",children:b}),(0,r.jsx)(a.z,{type:"submit",className:"w-full",children:"Create Account"})]})})]})})]})})}},5974:function(e,t,s){"use strict";s.d(t,{C:function(){return l}});var r=s(7437);s(2265);var n=s(7053),a=s(535),o=s(4508);let i=(0,a.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,asChild:a=!1,...l}=e,c=a?n.g7:"span";return(0,r.jsx)(c,{"data-slot":"badge",className:(0,o.cn)(i({variant:s}),t),...l})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var r=s(7437);s(2265);var n=s(7053),a=s(535),o=s(4508);let i=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:s,size:a,asChild:l=!1,...c}=e,d=l?n.g7:"button";return(0,r.jsx)(d,{"data-slot":"button",className:(0,o.cn)(i({variant:s,size:a,className:t})),...c})}},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return o},SZ:function(){return l},Zb:function(){return a},aY:function(){return c},ll:function(){return i}});var r=s(7437);s(2265);var n=s(4508);function a(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function o(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function i(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,n.cn)("leading-none font-semibold",t),...s})}function l(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...s})}function c(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...s})}},5186:function(e,t,s){"use strict";s.d(t,{I:function(){return a}});var r=s(7437);s(2265);var n=s(4508);function a(e){let{className:t,type:s,...a}=e;return(0,r.jsx)("input",{type:s,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}},5153:function(e,t,s){"use strict";s.d(t,{pm:function(){return m}});var r=s(2265);let n=0,a=new Map,o=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?o(s):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=i(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||r()}}}),{id:s,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=r.useState(c);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},376:function(e,t,s){"use strict";s.d(t,{s:function(){return a}});var r=s(2265),n=s(257);function a(e){let{onMessage:t,onConnect:s,onDisconnect:a,onReconnect:o,onError:i,maxReconnectAttempts:l=5,reconnectInterval:c=3e3,url:d}=e,[u,m]=(0,r.useState)(!1),[g,f]=(0,r.useState)(0),[x,h]=(0,r.useState)(null),[p,v]=(0,r.useState)(!1),[b,j]=(0,r.useState)(!1),y=(0,r.useRef)(null),w=(0,r.useRef)(),N=(0,r.useRef)([]),_=(0,r.useRef)(!0),S=(0,r.useRef)(0),C=(0,r.useRef)(!1),k=(0,r.useRef)(t),R=(0,r.useRef)(s),z=(0,r.useRef)(a),D=(0,r.useRef)(o),I=(0,r.useRef)(i);(0,r.useEffect)(()=>{k.current=t},[t]),(0,r.useEffect)(()=>{R.current=s},[s]),(0,r.useEffect)(()=>{z.current=a},[a]),(0,r.useEffect)(()=>{D.current=o},[o]),(0,r.useEffect)(()=>{I.current=i},[i]);let E=(0,r.useCallback)(()=>{let e=d;if(e||(e=n.env.NEXT_PUBLIC_WEBSOCKET_URL||"wss://".concat(window.location.host,"/ws")),console.log("[v0] WebSocket URL from env:",n.env.NEXT_PUBLIC_WEBSOCKET_URL),console.log("[v0] Constructed WebSocket URL:",e),console.log("[v0] Window location:",window.location.href),!e){console.log("[v0] No WebSocket URL available, running in offline mode"),j(!0),h("No WebSocket server configured");return}if(C.current){console.log("[v0] Connection attempt already in progress");return}try{console.log("[v0] Attempting WebSocket connection to:",e),C.current=!0,h(null),j(!1);let t=new WebSocket(e);y.current=t,t.onopen=()=>{var s;for(console.log("[v0] WebSocket connected successfully to:",e),C.current=!1,m(!0),f(0),S.current=0,v(!1),h(null),null===(s=R.current)||void 0===s||s.call(R);N.current.length>0;){let e=N.current.shift();t.readyState===WebSocket.OPEN&&t.send(JSON.stringify(e))}},t.onmessage=e=>{try{let t=e.data;if(console.log("[v0] Received WebSocket message:",t),"string"==typeof t&&t.startsWith("DEBUG:")){let e=t.substring(6),s=JSON.parse(e);s.payload?k.current(s.payload):k.current(s);return}if("string"==typeof t&&t.startsWith("Received: DEBUG:")){let e=t.substring(16),s=JSON.parse(e);s.payload?k.current(s.payload):k.current(s);return}let s=JSON.parse(t);k.current(s)}catch(t){if(console.error("[v0] Failed to parse WebSocket message:",t),console.error("[v0] Raw message was:",e.data),"string"==typeof e.data){if(e.data.includes("Request served by")||e.data.includes("echo.websocket.org")){console.log("[v0] Ignoring echo server response:",e.data);return}e.data.includes("DEBUG:")||e.data.includes("Received:")?k.current({func_name:"generalPopUpText",message:"Server debug: ".concat(e.data.substring(0,100),"...")}):k.current({func_name:"generalPopUpText",message:"Received: ".concat(e.data)})}}},t.onclose=e=>{var t;if(console.log("[v0] WebSocket disconnected. Code:",e.code,"Reason:",e.reason),C.current=!1,m(!1),y.current=null,null===(t=z.current)||void 0===t||t.call(z),_.current&&S.current<l){v(!0),S.current+=1,f(S.current);let e=c*Math.pow(1.5,S.current-1);console.log("[v0] Reconnecting in ".concat(e,"ms (attempt ").concat(S.current,"/").concat(l,")")),w.current=setTimeout(()=>{if(_.current){var e;null===(e=D.current)||void 0===e||e.call(D),E()}},e)}else S.current>=l&&(h("Failed to reconnect after multiple attempts"),v(!1))},t.onerror=s=>{var r;console.error("[v0] WebSocket error occurred:",s),console.error("[v0] WebSocket readyState:",t.readyState),console.error("[v0] WebSocket URL was:",e),C.current=!1,h("Connection failed to ".concat(e)),null===(r=I.current)||void 0===r||r.call(I,s)}}catch(e){console.error("[v0] Failed to create WebSocket connection:",e),C.current=!1,h("Failed to establish connection")}},[d,l,c]),O=(0,r.useCallback)(()=>{console.log("[v0] Manually disconnecting WebSocket"),_.current=!1,C.current=!1,clearTimeout(w.current),y.current&&y.current.close(1e3,"Manual disconnect"),m(!1),v(!1),f(0),S.current=0},[]),U=(0,r.useCallback)(e=>{var t;if((null===(t=y.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN)try{let t=JSON.stringify(e);y.current.send(t),console.log("[v0] Sent WebSocket message:",t)}catch(t){console.error("[v0] Failed to send WebSocket message:",t),N.current.push(e)}else console.log("[v0] WebSocket not connected, queueing message:",e),N.current.push(e),!C.current&&!p&&_.current&&S.current<l&&E()},[p,E,l]),T=(0,r.useCallback)(()=>{f(0),S.current=0,h(null),_.current=!0,C.current=!1,E()},[E]);return(0,r.useEffect)(()=>{_.current=!0;let e=setTimeout(()=>{_.current&&E()},100);return()=>{clearTimeout(e),_.current=!1,C.current=!1,clearTimeout(w.current),y.current&&y.current.close(1e3,"Component unmounting")}},[E]),{socket:y.current,connectionStatus:b?"offline":u?"connected":p?"reconnecting":"disconnected",isConnected:u,isReconnecting:p,reconnectAttempts:g,connectionError:x,isOfflineMode:b,sendMessage:U,disconnect:O,retry:T}}},4508:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var r=s(1994),n=s(3335);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[376,598,971,117,744],function(){return e(e.s=6679)}),_N_E=e.O()}]);